import re
from django.shortcuts import render, get_object_or_404, redirect
from django.utils import timezone
from django.urls import reverse
from django.http import Http404
from django.shortcuts import render
from django.http import HttpResponse
from .constants import ASMA_UL_HUSNA
from .constants import ARABIC_LETTERS
from .models import (
    Surah, Ayah,
    Root, Lexeme, Occurrence,
    Topic, TopicVerse
)

ARABIC_LETTERS = [
    "ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض",
    "ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي"
]

ROOTS_BY_LETTER = {
    "ا": [
        "أ ب ب","أ ب د","أ ب ق","أ ب ل","أ ب و","أ ب ي",
        "أ ت ي","أ ث ث","أ ث ر","أ ث ل","أ ث م",
        "أ ج ج","أ ج ر","أ ج ل",
        "أ ح د",
        "أ خ ذ","أ خ ر","أ خ و",
        "أ د د","أ د ي",
        "أ ذ ن","أ ذ ي",
        "أ ر ب","أ ر ض","أ ر ك",
        "أ ز ر","أ ز ز","أ ز ف",
        "أ س ر","أ س س","أ س ف","أ س ن","أ س و",
        "أ ش ر",
        "أ ص ر","أ ص ل",
        "أ ف ف","أ ف ق","أ ف ك","أ ف ل",
        "أ ك ل",
        "أ ل ت","أ ل ف","أ ل ل","أ ل م","أ ل ه","أ ل و",
        "أ م ت","أ م د","أ م ر","أ م ل","أ م م","أ م ن","أ م و",
        "أ ن ث","أ ن س","أ ن ف","أ ن م","أ ن ي",
        "أ ه ل",
        "أ و ب","أ و د","أ و ل","أ و ه","أ و ي",
        "أ ي د","أ ي م","أ ي ي",
        "أَبَارِيق","أَلَا","أَلَّا","أَم","أَمَّا","أَمْس","أَوْ",
        "أَيَّانَ","أَيَّتُهَا","أَيُّ","أَيُّوبَ","أَيِّ","أَيْنَ",
        "أُولَٰئِكَ",
        "إِبْرَاهِيم","إِبْلِيس","إِدْرِيسَ","إِذ","إِذًا","إِذَا","إِرَم",
        "إِسْتَبْرَق","إِسْحَاقَ","إِسْرَائِيل","إِسْمَاعِيلَ",
        "إِلَىٰ","إِلَّا","إِلْيَاسَ","إِمَّا","إِنَّ","إِنْ","إِيَّا",
        "التَّابُوت","التَّنُّورُۙ","التَّوْرٰية","الرُّومُۙ","الصَّفَا",
        "اللَّائِي","اللَّاتَ","اللَّهُ",
        "الْأَيْكَةِ","الْاِنْج۪يل","الْجُودِيِّ","الْحَوَارِيِّينَ",
        "الْعُزّٰى","الْـٰٔنَ","الْفِرْدَوْس","الْمَرْوَةَ","الْمَس۪يح",
        "الْيَاقُوتُ","الْيَسَعَ","الْيَهُود",
        "الٓرٰ۠","الٓمٓ","الٓمٓرٰ۠","الٓمٓصٓ",
        "اَحْمَدُۜ","اَفَهُم","اَنَا۬","اَنِ","اَنْ","اَنْتَ",
        "اَنْتُم","اَنْتُمَا","اَنْتُمْ","اَهٰكَذَا",
        "اَيَّانَ","اَيَّمَا","اِذَا","آدَم","آزَر","اٰنٍۚ","ا۪ي",
        "ٱلَّذِى",
    ]
}
ROOTS_BY_LETTER["ب"] = [
    "ب أ ر","ب أ س","ب ت ر","ب ت ك","ب ت ل","ب ث ث","ب ج س","ب ح ث","ب ح ر",
    "ب خ س","ب خ ع","ب خ ل","ب د أ","ب د ر","ب د ع","ب د ل","ب د ن","ب د و",
    "ب ذ ر","ب ر أ","ب ر ج","ب ر ح","ب ر د","ب ر ر","ب ر ز","ب ر ص","ب ر ق",
    "ب ر ك","ب ر م","ب ر ه ن","ب ز غ","ب س ر","ب س س","ب س ط","ب س ق","ب س ل",
    "ب س م","ب ش ر","ب ص ر","ب ص ل","ب ض ع","ب ط أ","ب ط ر","ب ط ش","ب ط ل",
    "ب ط ن","ب ع ث","ب ع ث ر","ب ع د","ب ع ر","ب ع ض","ب ع ل","ب غ ت","ب غ ض",
    "ب غ ل","ب غ ي","ب ق ر","ب ق ع","ب ق ل","ب ق ي","ب ك ر","ب ك م","ب ك ي",
    "ب ل د","ب ل س","ب ل ع","ب ل غ","ب ل و","ب ن ن","ب ن ي","ب ه ت","ب ه ج",
    "ب ه ل","ب ه م","ب و أ","ب و ب","ب و ر","ب و ل","ب ي ت","ب ي د","ب ي ض",
    "ب ي ع","ب ي ن","بَابِلَ","بَدْرٍ","بَرْزَخ","بَكَّةَ","بَلَىٰ","بَلْ",
    "بِكَ","بِكُمْ","بِنَٓا","بِهَٓا","بِهِ","بِهِمَا","بِهِمْ","بِهِنَّۘ",
    "بِه۪","بِيَ","ب۪ي",
]
ROOTS_BY_LETTER["ت"] = [
    "ت ب ب","ت ب ر","ت ب ع","ت ج ر","ت ح ت","ت ر ب","ت ر ف","ت ر ق","ت ر ك",
    "ت س ع","ت ع س","ت ف ث","ت ق ن","ت ل ل","ت ل و","ت م م","ت و ب","ت و ر",
    "ت ي ن","ت ي ه","تُبَّعٍ","تِلْكُم",
]
ROOTS_BY_LETTER["ث"] = [
    "ث ب ت","ث ب ر","ث ب ط","ث ب ي","ث ج ج","ث خ ن","ث ر ب","ث ر ي",
    "ث ع ب","ث ق ب","ث ق ف","ث ق ل","ث ل ث","ث ل ل","ث م ر","ث م ن",
    "ث ن ي","ث و ب","ث و ر","ث و ي","ث ي ب","ثَمُودَ","ثَمَّ",
]
ROOTS_BY_LETTER["ج"] = [
    "ج أ ر","ج ب ب","ج ب ت","ج ب ر","ج ب ل","ج ب ن","ج ب ه","ج ب ي",
    "ج ث ث","ج ث م","ج ث و","ج ح د","ج ح م","ج د ث","ج د د","ج د ر",
    "ج د ل","ج ذ ذ","ج ذ ع","ج ذ و","ج ر ح","ج ر د","ج ر ر","ج ر ز",
    "ج ر ع","ج ر ف","ج ر م","ج ر ي","ج ز أ","ج ز ع","ج ز ي","ج س د",
    "ج س س","ج س م","ج ع ل","ج ف أ","ج ف ن","ج ف و","ج ل ب","ج ل د",
    "ج ل س","ج ل ل","ج ل و","ج م ح","ج م د","ج م ع","ج م ل","ج م م",
    "ج ن ب","ج ن ح","ج ن د","ج ن ف","ج ن ن","ج ن ي","ج ه د","ج ه ر",
    "ج ه ز","ج ه ل","ج و ب","ج و د","ج و ر","ج و ز","ج و س","ج و ع",
    "ج و ف","ج و و","ج ي أ","ج ي ب","ج ي د","جَالُوتَ","جَهَنَّمُ",
]
ROOTS_BY_LETTER["ح"] = [
    "ح ب ب","ح ب ر","ح ب س","ح ب ط","ح ب ك","ح ب ل","ح ت م","ح ث ث",
    "ح ج ب","ح ج ج","ح ج ر","ح ج ز","ح د ب","ح د ث","ح د د","ح د ق",
    "ح ذ ر","ح ر ب","ح ر ث","ح ر ج","ح ر د","ح ر ر","ح ر س","ح ر ص",
    "ح ر ض","ح ر ف","ح ر ق","ح ر ك","ح ر م","ح ر ي","ح ز ب","ح ز ن",
    "ح س ب","ح س د","ح س ر","ح س س","ح س م","ح س ن","ح ش ر","ح ص ب",
    "ح ص ح ص","ح ص د","ح ص ر","ح ص ل","ح ص ن","ح ص ي","ح ض ر","ح ض ض",
    "ح ط ب","ح ط ط","ح ط م","ح ظ ر","ح ظ ظ","ح ف د","ح ف ر","ح ف ظ",
    "ح ف ف","ح ف و","ح ق ب","ح ق ف","ح ق ق","ح ك م","ح ل ف","ح ل ق",
    "ح ل ل","ح ل م","ح ل ي","ح م أ","ح م د","ح م ر","ح م ل","ح م م",
    "ح م ي","ح ن ث","ح ن ج ر","ح ن ذ","ح ن ف","ح ن ك","ح ن ن","ح و ب",
    "ح و ت","ح و ج","ح و ذ","ح و ر","ح و ز","ح و ش","ح و ط","ح و ل",
    "ح و ي","ح ي ث","ح ي د","ح ي ر","ح ي ص","ح ي ض","ح ي ف","ح ي ق",
    "ح ي ن","ح ي ي","حَتَّىٰ","حُنَيْنٍ","حٰمٓ",
]
ROOTS_BY_LETTER["خ"] = [
    "خ ب أ","خ ب ت","خ ب ث","خ ب ر","خ ب ز","خ ب ط","خ ب ل","خ ب و",
    "خ ت ر","خ ت م",
    "خ د د","خ د ع","خ د ن",
    "خ ذ ل",
    "خ ر ب","خ ر ج","خ ر د ل","خ ر ر","خ ر ص","خ ر ط م","خ ر ق",
    "خ ز ن","خ ز ي",
    "خ س أ","خ س ر","خ س ف",
    "خ ش ب","خ ش ع","خ ش ي",
    "خ ص ص","خ ص ف","خ ص م",
    "خ ض د","خ ض ر","خ ض ع",
    "خ ط أ","خ ط ب","خ ط ط","خ ط ف","خ ط و",
    "خ ف ت","خ ف ض","خ ف ف","خ ف ي",
    "خ ل د","خ ل ص","خ ل ط","خ ل ع","خ ل ف","خ ل ق","خ ل ل","خ ل و",
    "خ م د","خ م ر","خ م س","خ م ص","خ م ط",
    "خ ن ز ر","خ ن س","خ ن ق",
    "خ و ر","خ و ض","خ و ف","خ و ل","خ و ن","خ و ي",
    "خ ي ب","خ ي ر","خ ي ط","خ ي ل","خ ي م",
]
ROOTS_BY_LETTER["د"] = [
    "د أ ب","د ب ب","د ب ر",
    "د ث ر",
    "د ح ر","د ح ض","د ح و",
    "د خ ر","د خ ل","د خ ن",
    "د ر أ","د ر ج","د ر ر","د ر س","د ر ك","د ر ه م","د ر ي",
    "د س ر","د س س","د س و",
    "د ع ع","د ع و",
    "د ف أ","د ف ع","د ف ق",
    "د ك ك",
    "د ل ك","د ل ل","د ل و",
    "د م د م","د م ر","د م ع","د م غ","د م و",
    "د ن ر","د ن و",
    "د ه ر","د ه ق","د ه م","د ه ن","د ه ي",
    "د و ر","د و ل","د و م","د و ن",
    "د ي ن",
    "دَاوُود",
]
ROOTS_BY_LETTER["ذ"] = [
    "ذ أ ب","ذ أ م",
    "ذ ب ب","ذ ب ح","ذ ب ذ ب",
    "ذ خ ر",
    "ذ ر أ","ذ ر ر","ذ ر ع","ذ ر و",
    "ذ ع ن",
    "ذ ق ن",
    "ذ ك ر","ذ ك و",
    "ذ ل ل",
    "ذ م م",
    "ذ ن ب",
    "ذ ه ب","ذ ه ل",
    "ذ و د","ذ و ق",
    "ذ ي ع",
    "ذَا","ذَاتَ","ذَٰلِكَ","ذُو","ذِي",
]
ROOTS_BY_LETTER["ر"] = [
    "ر أ س","ر أ ف","ر أ ي",
    "ر ب ب","ر ب ح","ر ب ص","ر ب ط","ر ب ع","ر ب و",
    "ر ت ع","ر ت ق","ر ت ل",
    "ر ج ج","ر ج ز","ر ج س","ر ج ع","ر ج ف","ر ج ل","ر ج م","ر ج و",
    "ر ح ب","ر ح ق","ر ح ل","ر ح م",
    "ر خ و",
    "ر د أ","ر د د","ر د ف","ر د م","ر د ي",
    "ر ذ ل",
    "ر ز ق",
    "ر س خ","ر س س","ر س ل","ر س و",
    "ر ش د",
    "ر ص د","ر ص ص",
    "ر ض ع","ر ض و",
    "ر ط ب",
    "ر ع ب","ر ع د","ر ع ي",
    "ر غ ب","ر غ د","ر غ م",
    "ر ف ت","ر ف ث","ر ف د","ر ف ر ف","ر ف ع","ر ف ق",
    "ر ق ب","ر ق د","ر ق ق","ر ق م","ر ق ي",
    "ر ك ب","ر ك د","ر ك ز","ر ك س","ر ك ض","ر ك ع","ر ك م","ر ك ن",
    "ر م ح","ر م د","ر م ز","ر م م","ر م ن","ر م ي",
    "ر ه ب","ر ه ط","ر ه ق","ر ه ن","ر ه و",
    "ر و ح","ر و د","ر و ض","ر و ع","ر و غ",
    "ر ي ب","ر ي ش","ر ي ع","ر ي ن",
    "رَمَضَانَ","رُبَمَا",
]
ROOTS_BY_LETTER["ز"] = [
    "ز ب د","ز ب ر","ز ب ن",
    "ز ج ج","ز ج ر","ز ج و",
    "ز ح ز ح","ز ح ف",
    "ز خ ر ف",
    "ز ر ع","ز ر ق","ز ر ي",
    "ز ع م",
    "ز ف ر","ز ف ف",
    "ز ق م",
    "ز ك و",
    "ز ل ز ل","ز ل ف","ز ل ق","ز ل ل","ز ل م",
    "ز م ر","ز م ل","ز م ه ر",
    "ز ن م","ز ن ي",
    "ز ه د","ز ه ر","ز ه ق",
    "ز و ج","ز و د","ز و ر","ز و ل",
    "ز ي ت","ز ي د","ز ي غ","ز ي ل","ز ي ن",
    "زَرَابِيُّ","زَكَرِيَّا","زَنْجَبِيلًا","زَيْدٌ",
]
ROOTS_BY_LETTER["س"] = [
    "س أ ل","س أ م",
    "س ب ب","س ب ت","س ب ح","س ب ط","س ب ع","س ب غ","س ب ق","س ب ل",
    "س ت ت","س ت ر",
    "س ج د","س ج ر","س ج ل","س ج ن","س ج و",
    "س ح ب","س ح ت","س ح ر","س ح ق","س ح ل",
    "س خ ر","س خ ط",
    "س د د","س د ر","س د س","س د ي",
    "س ر ب","س ر ب ل","س ر ج","س ر ح","س ر د","س ر د ق","س ر ر","س ر ع","س ر ف","س ر ق","س ر م د","س ر ي",
    "س ط ح","س ط ر","س ط و",
    "س ع د","س ع ر","س ع ي",
    "س غ ب",
    "س ف ح","س ف ر","س ف ع","س ف ك","س ف ل","س ف ن","س ف ه",
    "س ق ط","س ق ف","س ق م","س ق ي",
    "س ك ب","س ك ت","س ك ر","س ك ن",
    "س ل ب","س ل ح","س ل خ","س ل س ل","س ل ط","س ل ف","س ل ق","س ل ك","س ل ل","س ل م","س ل و",
    "س م د","س م ر","س م ع","س م ك","س م م","س م ن","س م و",
    "س ن ب ل","س ن د","س ن م","س ن ن","س ن ه","س ن و",
    "س ه ر","س ه ل","س ه م","س ه و",
    "س و أ","س و ح","س و د","س و ر","س و ط","س و ع","س و غ","س و ق","س و ل","س و م","س و ي",
    "س ي ب","س ي ح","س ي ر","س ي ل",
    "سَبَإٍ","سَقَر","سَلْسَبِيلًا","سَيْنَٓاءَ","سُلَيْمَان","سُنْدُسٍ","سِينِينَ",
]
ROOTS_BY_LETTER["ش"] = [
    "ش أ م","ش أ ن",
    "ش ب ه",
    "ش ت ت","ش ت و",
    "ش ج ر",
    "ش ح ح","ش ح م","ش ح ن",
    "ش خ ص",
    "ش د د",
    "ش ر ب","ش ر ح","ش ر د","ش ر ذ م","ش ر ر","ش ر ط","ش ر ع","ش ر ق","ش ر ك","ش ر ي",
    "ش ط أ","ش ط ر","ش ط ط","ش ط ن",
    "ش ع ب","ش ع ر","ش ع ل",
    "ش غ ف","ش غ ل",
    "ش ف ع","ش ف ق","ش ف ه","ش ف و","ش ف ي",
    "ش ق ق","ش ق و",
    "ش ك ر","ش ك س","ش ك ك","ش ك ل","ش ك و",
    "ش م ت","ش م خ","ش م ز","ش م س","ش م ل",
    "ش ن أ",
    "ش ه ب","ش ه د","ش ه ر","ش ه ق","ش ه و",
    "ش و ب","ش و ر","ش و ظ","ش و ك","ش و ي",
    "ش ي أ","ش ي ب","ش ي خ","ش ي د","ش ي ع",
    "شُعَيْب",
]
ROOTS_BY_LETTER["ص"] = [
    "ص ب أ","ص ب ب","ص ب ح","ص ب ر","ص ب ع","ص ب غ","ص ب و",
    "ص ح ب","ص ح ف",
    "ص خ خ","ص خ ر",
    "ص د د","ص د ر","ص د ع","ص د ف","ص د ق","ص د ي",
    "ص ر ح","ص ر خ","ص ر ر","ص ر ص ر","ص ر ط","ص ر ع","ص ر ف","ص ر م",
    "ص ع د","ص ع ر","ص ع ق",
    "ص غ ر","ص غ و",
    "ص ف ح","ص ف د","ص ف ر","ص ف ص ف","ص ف ف","ص ف ن","ص ف و",
    "ص ك ك",
    "ص ل ب","ص ل ح","ص ل د","ص ل ص ل","ص ل و","ص ل ي",
    "ص م ت","ص م د","ص ع","ص م م",
    "ص ن ع","ص ن م","ص ن و",
    "ص ه ر",
    "ص و ب","ص و ت","ص و ر","ص و ع","ص و ف","ص و م",
    "ص ي ح","ص ي د","ص ي ر","ص ي ص","ص ي ف",
    "صٓ",
]
ROOTS_BY_LETTER["ض"] = [
    "ض أ ن",
    "ض ب ح",
    "ض ج ع",
    "ض ح ك",
    "ض ح و",
    "ض د د",
    "ض ر ب",
    "ض ر ر",
    "ض ر ع",
    "ض ع ف",
    "ض غ ث",
    "ض غ ن",
    "ض ف د ع",
    "ض ل ل",
    "ض م ر",
    "ض م م",
    "ض ن ك",
    "ض ن ن",
    "ض ه أ",
    "ض و أ",
    "ض ي ر",
    "ض ي ز",
    "ض ي ع",
    "ض ي ف",
    "ض ي ق",
]
ROOTS_BY_LETTER["ط"] = [
    "ط ب ع",
    "ط ب ق",
    "ط ح و",
    "ط ر ح",
    "ط ر د",
    "ط ر ف",
    "ط ر ق",
    "ط ر و",
    "ط ع م",
    "ط ع ن",
    "ط غ ي",
    "ط ف أ",
    "ط ف ف",
    "ط ف ق",
    "ط ف ل",
    "ط ل ب",
    "ط ل ح",
    "ط ل ع",
    "ط ل ق",
    "ط ل ل",
    "ط م ث",
    "ط م س",
    "ط م ع",
    "ط م م",
    "ط م ن",
    "ط ه ر",
    "ط و د",
    "ط و ر",
    "ط و ع",
    "ط و ف",
    "ط و ق",
    "ط و ل",
    "ط و ي",
    "ط ي ب",
    "ط ي ر",
    "ط ي ن",
    "طَالُوت",
    "طٰسٓمٓۜ",
    "طٰسٓ۠",
    "طٰهٰۜ",
]
ROOTS_BY_LETTER["ظ"] = [
    "ظ ع ن",
    "ظ ف ر",
    "ظ ل ل",
    "ظ ل م",
    "ظ م أ",
    "ظ ن ن",
    "ظ ه ر",
]
ROOTS_BY_LETTER["ع"] = [
    "ع ب أ",
    "ع ب ث",
    "ع ب د",
    "ع ب ر",
    "ع ب س",
    "ع ب ق ر",
    "ع ت ب",
    "ع ت د",
    "ع ت ق",
    "ع ت ل",
    "ع ت و",
    "ع ث ر",
    "ع ث و",
    "ع ج ب",
    "ع ج ز",
    "ع ج ف",
    "ع ج ل",
    "ع ج م",
    "ع د د",
    "ع د س",
    "ع د ل",
    "ع د و",
    "ع ذ ب",
    "ع ذ ر",
    "ع ر ب",
    "ع ر ج",
    "ع ر ج ن",
    "ع ر ر",
    "ع ر ش",
    "ع ر ض",
    "ع ر ف",
    "ع ر م",
    "ع ر و",
    "ع ر ي",
    "ع ز ب",
    "ع ز ر",
    "ع ز ز",
    "ع ز ل",
    "ع ز م",
    "ع ز و",
    "ع س ر",
    "ع س ع س",
    "ع س ل",
    "ع س ي",
    "ع ش ر",
    "ع ش و",
    "ع ص ب",
    "ع ص ر",
    "ع ص ف",
    "ع ص م",
    "ع ص و",
    "ع ص ي",
    "ع ض د",
    "ع ض ض",
    "ع ض ل",
    "ع ض و",
    "ع ط ف",
    "ع ط ل",
    "ع ط و",
    "ع ظ م",
    "ع ف ر",
    "ع ف ف",
    "ع ف و",
    "ع ق ب",
    "ع ق د",
    "ع ق ر",
    "ع ق ل",
    "ع ق م",
    "ع ك ف",
    "ع ل ق",
    "ع ل م",
    "ع ل ن",
    "ع ل و",
    "ع م د",
    "ع م ر",
    "ع م ق",
    "ع م ل",
    "ع م م",
    "ع م ه",
    "ع م ي",
    "ع ن ب",
    "ع ن ت",
    "ع ن د",
    "ع ن ق",
    "ع ن ك ب",
    "ع ن و",
    "ع ه د",
    "ع ه ن",
    "ع و ج",
    "ع و د",
    "ع و ذ",
    "ع و ر",
    "ع و ق",
    "ع و ل",
    "ع و م",
    "ع و ن",
    "ع ي ب",
    "ع ي ر",
    "ع ي ش",
    "ع ي ل",
    "ع ي ن",
    "ع ي ي",
    "عَدْنٍ",
    "عَرَفَات",
    "عَلَىٰ",
    "عَنْ",
    "عُزَيْرٌ",
    "عِمْرٰنَ",
    "عِيسَى",
    "عٓسٓقٓ۠",
]
ROOTS_BY_LETTER["غ"] = [
    "غ ب ر",
    "غ ب ن",
    "غ ث و",
    "غ د ر",
    "غ د ق",
    "غ د و",
    "غ ر ب",
    "غ ر ر",
    "غ ر ف",
    "غ ر ق",
    "غ ر م",
    "غ ر و",
    "غ ز ل",
    "غ ز و",
    "غ س ق",
    "غ س ل",
    "غ ش و",
    "غ ص ب",
    "غ ص ص",
    "غ ض ب",
    "غ ض ض",
    "غ ط ش",
    "غ ط و",
    "غ ف ر",
    "غ ف ل",
    "غ ل ب",
    "غ ل ظ",
    "غ ل ف",
    "غ ل ق",
    "غ ل ل",
    "غ ل م",
    "غ ل و",
    "غ ل ي",
    "غ م ر",
    "غ م ز",
    "غ م ض",
    "غ م م",
    "غ ن م",
    "غ ن ي",
    "غ و ث",
    "غ و ر",
    "غ و ص",
    "غ و ط",
    "غ و ل",
    "غ و ي",
    "غ ي ب",
    "غ ي ث",
    "غ ي ر",
    "غ ي ض",
    "غ ي ظ",
]
ROOTS_BY_LETTER["ف"] = [
    "ف أ د",
    "ف أ ي",
    "ف ت أ",
    "ف ت ح",
    "ف ت ر",
    "ف ت ق",
    "ف ت ل",
    "ف ت ن",
    "ف ت ي",
    "ف ج ج",
    "ف ج ر",
    "ف ج و",
    "ف ح ش",
    "ف خ ر",
    "ف د ي",
    "ف ر ت",
    "ف ر ث",
    "ف ر ج",
    "ف ر ح",
    "ف ر د",
    "ف ر ر",
    "ف ر ش",
    "ف ر ض",
    "ف ر ط",
    "ف ر ع",
    "ف ر غ",
    "ف ر ق",
    "ف ر ه",
    "ف ر ي",
    "ف ز ز",
    "ف ز ع",
    "ف س ح",
    "ف س د",
    "ف س ر",
    "ف س ق",
    "ف ش ل",
    "ف ص ح",
    "ف ص ل",
    "ف ص م",
    "ف ض ح",
    "ف ض ض",
    "ف ض ل",
    "ف ض و",
    "ف ط ر",
    "ف ظ ظ",
    "ف ع ل",
    "ف ق د",
    "ف ق ر",
    "ف ق ع",
    "ف ق ه",
    "ف ك ر",
    "ف ك ك",
    "ف ك ه",
    "ف ل ح",
    "ف ل ق",
    "ف ل ك",
    "ف ل ن",
    "ف ن د",
    "ف ن ن",
    "ف ن ي",
    "ف ه م",
    "ف و ت",
    "ف و ج",
    "ف و ر",
    "ف و ز",
    "ف و ض",
    "ف و ق",
    "ف و م",
    "ف و ه",
    "ف ي أ",
    "ف ي ض",
    "ف ي ل",
    "فَاِلَّمْ",
    "فَذَانِكَ",
    "فَلَهُمَا",
    "فَلَهُمْ",
    "فَهُمْ",
    "فَهُوَ",
    "فِرْعَوْنَ",
    "فِي",
]
ROOTS_BY_LETTER["ق"] = [
    "ق ب ح",
    "ق ب ر",
    "ق ب س",
    "ق ب ض",
    "ق ب ل",
    "ق ت ر",
    "ق ت ل",
    "ق ث أ",
    "ق ح م",
    "ق د ح",
    "ق د د",
    "ق د ر",
    "ق د س",
    "ق د م",
    "ق د و",
    "ق ذ ف",
    "ق ر أ",
    "ق ر ب",
    "ق ر ح",
    "ق ر د",
    "ق ر ر",
    "ق ر ض",
    "ق ر ط س",
    "ق ر ع",
    "ق ر ف",
    "ق ر ن",
    "ق ر ي",
    "ق س ر",
    "ق س س",
    "ق س ط",
    "ق س ط س",
    "ق س م",
    "ق س و",
    "ق ش ع ر",
    "ق ص د",
    "ق ص ر",
    "ق ص ص",
    "ق ص ف",
    "ق ص م",
    "ق ص و",
    "ق ض ب",
    "ق ض ض",
    "ق ض ي",
    "ق ط ر",
    "ق ط ط",
    "ق ط ع",
    "ق ط ف",
    "ق ط م ر",
    "ق ع د",
    "ق ع ر",
    "ق ف ل",
    "ق ف و",
    "ق ل ب",
    "ق ل د",
    "ق ل ع",
    "ق ل ل",
    "ق ل م",
    "ق ل ي",
    "ق م ح",
    "ق م ر",
    "ق م ص",
    "ق م ط ر",
    "ق م ع",
    "ق م ل",
    "ق ن ت",
    "ق ن ط",
    "ق ن ط ر",
    "ق ن ع",
    "ق ن و",
    "ق ن ي",
    "ق ه ر",
    "ق و ب",
    "ق و ت",
    "ق و س",
    "ق و ع",
    "ق و ل",
    "ق و م",
    "ق و ي",
    "ق ي ض",
    "ق ي ل",
    "قَارُون",
    "قَدْ",
    "قُرَيْشٍ",
    "قٓ۠",
]
ROOTS_BY_LETTER["ك"] = [
    "ك أ س",
    "ك ب ب",
    "ك ب ت",
    "ك ب د",
    "ك ب ر",
    "ك ب ك ب",
    "ك ت ب",
    "ك ت م",
    "ك ث ب",
    "ك ث ر",
    "ك د ح",
    "ك د ر",
    "ك د ي",
    "ك ذ ب",
    "ك ر ب",
    "ك ر ر",
    "ك ر س",
    "ك ر م",
    "ك ر ه",
    "ك س ب",
    "ك س د",
    "ك س ف",
    "ك س ل",
    "ك س و",
    "ك ش ط",
    "ك ش ف",
    "ك ظ م",
    "ك ع ب",
    "ك ف أ",
    "ك ف ت",
    "ك ف ر",
    "ك ف ف",
    "ك ف ل",
    "ك ف ي",
    "ك ل أ",
    "ك ل ب",
    "ك ل ح",
    "ك ل ف",
    "ك ل ل",
    "ك ل م",
    "ك ل و",
    "ك م ل",
    "ك م ه",
    "ك ن د",
    "ك ن ز",
    "ك ن س",
    "ك ن ن",
    "ك ه ف",
    "ك ه ل",
    "ك ه ن",
    "ك و ب",
    "ك و د",
    "ك و ر",
    "ك و ك ب",
    "ك و ن",
    "ك و ي",
    "ك ي د",
    "ك ي ف",
    "ك ي ل",
    "ك ي ن",
    "كَأَنَّ",
    "كَلَّا",
    "كَمَا",
    "كَمْ",
    "كَيْ",
    "كٓهٰيٰعٓصٓۜ",
]
ROOTS_BY_LETTER["ل"] = [
    "ل أ ل أ",
    "ل ب ب",
    "ل ب ث",
    "ل ب د",
    "ل ب س",
    "ل ب ن",
    "ل ج أ",
    "ل ج ج",
    "ل ح د",
    "ل ح ف",
    "ل ح ق",
    "ل ح م",
    "ل ح ن",
    "ل ح ي",
    "ل د د",
    "ل د ن",
    "ل ذ ذ",
    "ل ز ب",
    "ل ز م",
    "ل س ن",
    "ل ط ف",
    "ل ظ ي",
    "ل ع ب",
    "ل ع ن",
    "ل غ ب",
    "ل غ و",
    "ل ف ت",
    "ل ف ح",
    "ل ف ظ",
    "ل ف ف",
    "ل ف و",
    "ل ق ب",
    "ل ق ح",
    "ل ق ط",
    "ل ق ف",
    "ل ق م",
    "ل ق ي",
    "ل م ح",
    "ل م ز",
    "ل م س",
    "ل م م",
    "ل ه ب",
    "ل ه ث",
    "ل ه م",
    "ل ه و",
    "ل و ت",
    "ل و ح",
    "ل و ذ",
    "ل و م",
    "ل و ن",
    "ل و ي",
    "ل ي ت",
    "ل ي س",
    "ل ي ل",
    "ل ي ن",
    "لَا",
    "لَدَا",
    "لَدَي",
    "لَظٰى",
    "لَعَلّ۪ٓي",
    "لَكَ",
    "لَكُم",
    "لَكُمَا",
    "لَكُمُ",
    "لَكِ",
    "لَمَّا",
    "لَنَا",
    "لَنْ",
    "لَهَا",
    "لَهُ",
    "لَهُم",
    "لَهُمَا",
    "لَهُنَّ",
    "لَهُوَ",
    "لَو",
    "لَوْ",
    "لَوْلَا",
    "لَيْتَ",
    "لُقْمٰن",
    "لُوطٍ",
    "لِكَيْلَا",
    "لِيَ",
    "لٰكِنِ",
    "ل۪ي",
]
ROOTS_BY_LETTER["م"] = [
    "م أ ي",
    "م ت ع",
    "م ت ن",
    "م ث ل",
    "م ج د",
    "م ج س",
    "م ح ص",
    "م ح ق",
    "م ح ل",
    "م ح ن",
    "م ح و",
    "م خ ر",
    "م خ ض",
    "م د د",
    "م د ن",
    "م ر أ",
    "م ر ج",
    "م ر ح",
    "م ر د",
    "م ر ر",
    "م ر ض",
    "م ر ي",
    "م ز ج",
    "م ز ق",
    "م ز ن",
    "م س ح",
    "م س خ",
    "م س د",
    "م س س",
    "م س ك",
    "م س و",
    "م ش ج",
    "م ش ي",
    "م ص ر",
    "م ض غ",
    "م ض ي",
    "م ط ر",
    "م ط و",
    "م ع ز",
    "م ع ن",
    "م ع ي",
    "م ق ت",
    "م ك ث",
    "م ك ر",
    "م ك ن",
    "م ك و",
    "م ل أ",
    "م ل ح",
    "م ل ق",
    "م ل ك",
    "م ل ل",
    "م ل و",
    "م ن ع",
    "م ن ن",
    "م ن ي",
    "م ه د",
    "م ه ل",
    "م ه ن",
    "م و ت",
    "م و ج",
    "م و ر",
    "م و ل",
    "م و ه",
    "م ي د",
    "م ي ر",
    "م ي ز",
    "م ي ل",
    "مَأْجُوج",
    "مَا",
    "مَاذَا",
    "مَارُوتَ",
    "مَتَىٰ",
    "مَدْيَنَ",
    "مَرْيَم",
    "مَعَ",
    "مَكَّةَ",
    "مَنْ",
    "مَنٰوةَ",
    "مَهْمَا",
    "مُحَمَّد",
    "مُوسَىٰ",
    "مِمَّا",
    "مِنْ",
    "مِيكَالَ",
]
ROOTS_BY_LETTER["ن"] = [
    "ن أ ي",
    "ن ب أ",
    "ن ب ت",
    "ن ب ذ",
    "ن ب ز",
    "ن ب ط",
    "ن ب ع",
    "ن ت ق",
    "ن ث ر",
    "ن ج د",
    "ن ج س",
    "ن ج م",
    "ن ج و",
    "ن ح ب",
    "ن ح ت",
    "ن ح ر",
    "ن ح س",
    "ن ح ل",
    "ن خ ر",
    "ن خ ل",
    "ن د د",
    "ن د م",
    "ن د و",
    "ن ذ ر",
    "ن ز ع",
    "ن ز غ",
    "ن ز ف",
    "ن ز ل",
    "ن س أ",
    "ن س ب",
    "ن س خ",
    "ن س ر",
    "ن س ف",
    "ن س ك",
    "ن س ل",
    "ن س و",
    "ن س ي",
    "ن ش أ",
    "ن ش ر",
    "ن ش ز",
    "ن ش ط",
    "ن ص ب",
    "ن ص ت",
    "ن ص ح",
    "ن ص ر",
    "ن ص ف",
    "ن ص ي",
    "ن ض ج",
    "ن ض خ",
    "ن ض د",
    "ن ض ر",
    "ن ط ح",
    "ن ط ف",
    "ن ط ق",
    "ن ظ ر",
    "ن ع ج",
    "ن ع س",
    "ن ع ق",
    "ن ع ل",
    "ن ع م",
    "ن غ ض",
    "ن ف ث",
    "ن ف ح",
    "ن ف خ",
    "ن ف د",
    "ن ف ذ",
    "ن ف ر",
    "ن ف س",
    "ن ف ش",
    "ن ف ع",
    "ن ف ق",
    "ن ف ل",
    "ن ف ي",
    "ن ق ب",
    "ن ق ذ",
    "ن ق ر",
    "ن ق ص",
    "ن ق ض",
    "ن ق ع",
    "ن ق م",
    "ن ك ب",
    "ن ك ث",
    "ن ك ح",
    "ن ك د",
    "ن ك ر",
    "ن ك س",
    "ن ك ص",
    "ن ك ف",
    "ن ك ل",
    "ن م ل",
    "ن م م",
    "ن ه ج",
    "ن ه ر",
    "ن ه ي",
    "ن و أ",
    "ن و ب",
    "ن و ر",
    "ن و س",
    "ن و ش",
    "ن و ص",
    "ن و ق",
    "ن و م",
    "ن و ن",
    "ن و ي",
    "ن ي ل",
    "نَحْنُ",
    "نَعَمْ",
    "نَمَارِقُ",
    "نُوحٍ",
    "نٓ",
]
ROOTS_BY_LETTER["و"] = [
    "و أ د",
    "و أ ل",
    "و ب ر",
    "و ب ق",
    "و ب ل",
    "و ت د",
    "و ت ر",
    "و ت ن",
    "و ث ق",
    "و ث ن",
    "و ج ب",
    "و ج د",
    "و ج س",
    "و ج ف",
    "و ج ل",
    "و ج ه",
    "و ح د",
    "و ح ش",
    "و ح ي",
    "و د د",
    "و د ع",
    "و د ق",
    "و د ي",
    "و ذ ر",
    "و ر ث",
    "و ر د",
    "و ر ق",
    "و ر ي",
    "و ز ر",
    "و ز ع",
    "و ز ن",
    "و س ط",
    "و س ع",
    "و س ق",
    "و س ل",
    "و س م",
    "و س ن",
    "و س و س",
    "و ش ي",
    "و ص ب",
    "و ص د",
    "و ص ف",
    "و ص ل",
    "و ص ي",
    "و ض ع",
    "و ض ن",
    "و ط أ",
    "و ط ر",
    "و ط ن",
    "و ع د",
    "و ع ظ",
    "و ع ي",
    "و ف د",
    "و ف ر",
    "و ف ض",
    "و ف ق",
    "و ف ي",
    "و ق ب",
    "و ق ت",
    "و ق د",
    "و ق ذ",
    "و ق ر",
    "و ق ع",
    "و ق ف",
    "و ق ي",
    "و ك أ",
    "و ك د",
    "و ك ز",
    "و ك ل",
    "و ل ج",
    "و ل د",
    "و ل ي",
    "و ن ي",
    "و ه ب",
    "و ه ج",
    "و ه ن",
    "و ه ي",
    "وَجِبْرِيلَ",
    "وَكَأَيِّنْ",
    "وَلَٰكِنَّ",
    "وَلٰكِن",
    "وَيْكَاَنَّ",
    "وَيْلٌ",
]
ROOTS_BY_LETTER["ه"] = [
    "ه أ ت",
    "ه ب ط",
    "ه ب و",
    "ه ج د",
    "ه ج ر",
    "ه ج ع",
    "ه د د",
    "ه د م",
    "ه د ه د",
    "ه د ي",
    "ه ر ب",
    "ه ر ع",
    "ه ز أ",
    "ه ز ز",
    "ه ز ل",
    "ه ز م",
    "ه ش ش",
    "ه ش م",
    "ه ض م",
    "ه ط ع",
    "ه ل ع",
    "ه ل ك",
    "ه ل ل",
    "ه م د",
    "ه م ر",
    "ه م ز",
    "ه م س",
    "ه م م",
    "ه م ن",
    "ه ن أ",
    "ه و د",
    "ه و ر",
    "ه و ن",
    "ه و ي",
    "ه ي أ",
    "ه ي ت",
    "ه ي ج",
    "ه ي ل",
    "ه ي م",
    "هَاؤُمُ",
    "هَاتَيْنِ",
    "هَارُوتَ",
    "هَارُونَ",
    "هَامَان",
    "هَلْ",
    "هَيْهَاتَ",
    "هَٓا",
    "هَٰذَا",
    "هُم",
    "هُمْ",
    "هُنَالِكَ",
    "هُنَّ",
    "هُوَ",
    "هِيَ",
    "هٰذَانِ",
    "هٰهُنَا",
    "هٰٓؤُ۬لَٓاءِ",
]
ROOTS_BY_LETTER["ي"] = [
    "ي أ س",
    "ي ب س",
    "ي ت م",
    "ي د ي",
    "ي س ر",
    "ي ق ظ",
    "ي ق ن",
    "ي م م",
    "ي م ن",
    "ي ن ع",
    "ي و م",
    "يَأْجُوج",
    "يَا",
    "يَثْرِبَ",
    "يَحْيَىٰ",
    "يَعُوقَ",
    "يَعْقُوبَ",
    "يَغُوثَ",
    "يَقْط۪ينٍ",
    "يُوسُف",
    "يُونُسَ",
    "يٰسٓۜ",
]
def home(request):
    return redirect("core:roots-letters")

def roots_letters(request, letter=None):
    return render(request, "core/kokler.html", {"letters": LETTERS, "letter": letter})

def taqqoslash(request):
    return render(request, "core/taqqoslash.html")

def search(request):
    q = request.GET.get("q", "").strip()
    return HttpResponse(f"Qidiruv (test): {q}")

def roots_by_letter(request, letter):
    if letter not in LETTERS:
        raise Http404("Noto'g'ri harf")
    return roots_letters(request, letter=letter)
try:
    from hijri_converter import convert as hijri_convert  
except Exception:
    hijri_convert = None


AR_LETTERS = list("ابتثجحخدذرزسشصضطظعغفقكلمنهوي")

MONTHS_UZ = [
    "yanvar","fevral","mart","aprel","may","iyun",
    "iyul","avgust","sentyabr","oktyabr","noyabr","dekabr"
]
HIJRI_MONTHS_UZ = [
    "Muharram","Safar","Rabi‘ul-avval","Rabi‘us-soniy",
    "Jumodal-avval","Jumodal-oxir","Rajab","Sha’bon",
    "Ramazon","Shavvol","Zulqa‘da","Zulhijja"
]

def _today_strings():
    """
    UI header/footer uchun bugungi sana (gregorian + hijriy).
    Hijriy konverter bo‘lmasa, faqat gregorian qaytaradi.
    """
    now = timezone.localtime()
    greg = f"{now.day} {MONTHS_UZ[now.month-1]} {now.year}"
    hijri = ""
    if hijri_convert:
        h = hijri_convert.Gregorian(now.year, now.month, now.day).to_hijri()
        hijri = f"{h.day} {HIJRI_MONTHS_UZ[h.month-1]} {h.year}"
    return greg, hijri
def roots_by_letter(request, letter):
    if letter not in ARABIC_LETTERS:
        raise Http404("Bunday harf yo‘q.")
    roots = ROOTS_BY_LETTER.get(letter, [])
    return render(request, "core/kokler.html", {
        "letters": ARABIC_LETTERS,
        "letter": letter,
        "roots": roots,
    })

def roots_letters(request):
    return kokler_index(request)


def _normalize_harf(raw):
    """
    QueryString’dan kelgan qiymatdan arabcha harfni ajratib oladi.
    Masalan: "{'ch': 'ت', 'c': 0}" -> "ت"
    """
    if not raw:
        return None
    m = re.search(r'[\u0600-\u06FF]', raw)
    return m.group(0) if m else raw


def home(request):
    """Bosh sahifa."""
    return render(request, "core/home.html")


def ayet_karsilastirma(request):
    """Oyatlarni taqqoslash — placeholder sahifa."""
    return render(request, "core/ayet_karsilastirma.html")


def satrlar(request):
    """Satrlar (satrlararo ko‘rinish) — placeholder sahifa."""
    return render(request, "core/satrlar.html")


def el_mufredat(request):
    """EL-Mufredat — placeholder sahifa."""
    return render(request, "core/el_mufredat.html")


def el_mucem(request):
    """EL-Mu‘cem EL-Mufehres — placeholder sahifa."""
    return render(request, "core/el_mucem.html")


def page_goto(request):
    """Oddiy sahifa ko‘rsatish (masalan, preview yoki statik sahifalar)."""
    p = request.GET.get("p", "1")
    return render(request, "core/page.html", {"page_no": p})

def suralar(request):
    return render(request, "core/suralar.html")

def asmaul_husna(request):
    return render(request, "core/asmaul_husna.html", {"asma": ASMA_UL_HUSNA})
def sura_goto(request):
    """
    /sura-goto/?s=2&a=3 -> sura sahifasiga yo‘naltiradi.
    s (sura raqami), a (ixtiyoriy – oyat raqami)
    """
    sura = request.GET.get("s") or request.GET.get("sura") or ""
    ayah = request.GET.get("a") or request.GET.get("ayat") or ""

    if not (sura and sura.isdigit()):
        return render(request, "core/sura_jump.html", {"error": None})

    sura_no = int(sura)
    url = reverse("sura_detail", kwargs={"index": sura_no})
    if ayah:
        url += f"?a={ayah}"
    return redirect(url)


def sura_detail(request, index: int):
    sura = get_object_or_404(Surah, number=index) 
    ayahs = Ayah.objects.filter(surah=sura).order_by("number_in_surah")
    greg, hijri = _today_strings()
    return render(request, "core/sura_detail.html", {
        "sura": sura, "ayahs": ayahs, "greg_date": greg, "hijri_date": hijri
    })



def search(request):
    q = request.GET.get("q", "").strip()
    sura_results = Surah.objects.none()
    ayah_results = Ayah.objects.none()
    if q:
        sura_results = Surah.objects.filter(name_ar__icontains=q).order_by("number")
        ayah_results = (
            Ayah.objects
            .filter(text_ar__icontains=q)
            .select_related("surah")
            .order_by("surah__number", "number_in_surah")[:100]
        )
    return render(request, "core/search.html",
                  {"q": q, "sura_results": sura_results, "ayah_results": ayah_results})

def kokler_index(request):
    return render(request, "core/kokler.html", {
        "letters": ARABIC_LETTERS,
        "letter": None,
        "roots": []
    })

def kokler_root(request, root):
    """
    Bitta kök sahifasi: shakllar (lexeme) va oyatlarda uchrashlari.
    """
    r = get_object_or_404(Root, root_ar=root)

    forms = Lexeme.objects.filter(root=r).order_by("form_ar")
    occ = (
        Occurrence.objects
        .filter(lexeme__root=r)
        .select_related("lexeme", "surah")
        .order_by("surah__number", "ayah_no") 
    )

    ctx = {
        "root": r,
        "forms": forms,
        "occ": occ,
        "total": occ.count(),
    }
    return render(request, "core/kokler_root.html", ctx)

def fihrist(request):
    return render(request, "core/fihrist.html")

def fihrist_index(request):
    """Mavzular ro‘yxati (fihrist)."""
    topics = Topic.objects.order_by("title")
    return render(request, "core/fihrist_index.html", {"topics": topics})

def fihrist_topic(request, slug):
    """Tanlangan mavzuga bog‘liq oyatlar ro‘yxati."""
    topic = get_object_or_404(Topic, slug=slug)
    verses = (
        TopicVerse.objects
        .filter(topic=topic)
        .select_related("surah")
        .order_by("surah__number", "ayah_no") 
    )
    return render(request, "core/fihrist_topic.html", {"topic": topic, "verses": verses})

